{"version":3,"file":"texgen-workers.js","sources":["workers.js"],"sourcesContent":["export function getWorkers(path, max) {\r\n    var workers = [];\r\n    var waiting = [];\r\n\r\n    function worker() {\r\n        var free = workers.filter(function (d) {\r\n            return d.free;\r\n        });\r\n\r\n        if (free.length) {\r\n            free[0].free = false;\r\n            return free[0];\r\n        }\r\n\r\n        var w = wrap(!(workers.length < max));\r\n        w.free = false;\r\n\r\n        if (workers.length < max) {\r\n            workers.push(w);\r\n        } else {\r\n            waiting.push(w);\r\n        }\r\n\r\n        return w;\r\n    }\r\n\r\n    function wrap(queue) {\r\n        var o = {\r\n            free: true,\r\n            worker: queue ? null : new Worker(path),\r\n            onmessage: null,\r\n            toBePosted: null,\r\n            postMessage: postMessage\r\n        };\r\n\r\n        function postMessage(msg) {\r\n            if (o.worker) {\r\n                o.worker.onmessage = function (e) {\r\n                    o.onmessage(e);\r\n\r\n                    setTimeout(function () {\r\n                        o.free = true;\r\n                        o.toBePosted = null;\r\n                        o.onmessage = null;\r\n\r\n                        if (waiting.length) {\r\n                            o.free = false;\r\n                            var w = waiting.shift();\r\n                            o.onmessage = w.onmessage;\r\n                            o.postMessage(w.toBePosted);\r\n                        }\r\n                    });\r\n                };\r\n                o.worker.postMessage(msg);\r\n            } else {\r\n                o.toBePosted = msg;\r\n            }\r\n        }\r\n\r\n        return o;\r\n    }\r\n\r\n    return {\r\n        worker: worker,\r\n        terminate: function () {\r\n            waiting = [];\r\n            workers.forEach(function (o) {\r\n                if(o.worker) {\r\n                    o.worker.onmessage = null;\r\n                    o.worker.terminate();\r\n                    o.worker = null;\r\n                }\r\n            });\r\n            workers = [];\r\n        }\r\n    }\r\n}\r\n"],"names":["getWorkers","path","max","worker","free","workers","filter","d","length","w","wrap","push","queue","postMessage","msg","o","onmessage","e","toBePosted","waiting","shift","Worker","forEach","terminate"],"mappings":"0LAAO,SAASA,GAAWC,EAAMC,WAIpBC,QACDC,GAAOC,EAAQC,OAAO,SAAUC,SACzBA,GAAEH,UAGTA,EAAKI,gBACA,GAAGJ,MAAO,EACRA,EAAK,MAGZK,GAAIC,IAAOL,EAAQG,OAASN,aAC9BE,MAAO,EAELC,EAAQG,OAASN,IACTS,KAAKF,KAELE,KAAKF,GAGVA,UAGFC,GAAKE,WASDC,GAAYC,GACbC,EAAEZ,UACAA,OAAOa,UAAY,SAAUC,KACzBD,UAAUC,cAED,gBACLb,MAAO,IACPc,WAAa,OACbF,UAAY,KAEVG,EAAQX,OAAQ,GACdJ,MAAO,KACLK,GAAIU,EAAQC,UACdJ,UAAYP,EAAEO,YACdH,YAAYJ,EAAES,kBAI1Bf,OAAOU,YAAYC,MAEnBI,WAAaJ,KA5BnBC,UACM,SACEH,EAAQ,KAAO,GAAIS,QAAOpB,aACvB,gBACC,iBACCY,SA2BVE,MA1DPV,MACAc,mBA6DQhB,YACG,kBAECmB,QAAQ,SAAUP,GACnBA,EAAEZ,WACCA,OAAOa,UAAY,OACnBb,OAAOoB,cACPpB,OAAS"}